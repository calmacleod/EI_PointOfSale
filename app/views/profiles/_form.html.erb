<%= form_with model: user, url: profile_path, method: :patch, class: "divide-y divide-[var(--color-border)]" do |f| %>
  <% if user.errors.any? %>
    <div class="rounded-t-lg bg-[var(--color-error-bg)] px-3 py-2">
      <p class="text-sm font-semibold text-[var(--color-error-text)]">Please fix the following:</p>
      <ul class="mt-1 list-disc space-y-0.5 pl-5 text-sm text-[var(--color-error-text)]">
        <% user.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="px-3 py-2.5">
    <div class="flex items-center justify-between">
      <div>
        <h2 class="text-xs font-semibold uppercase tracking-wider text-muted">Contact</h2>
        <p class="text-xs text-muted">How we reach you and how you sign in.</p>
      </div>
      <span class="inline-flex items-center rounded-full bg-[var(--color-border)]/50 px-2 py-0.5 text-xs font-medium text-body">
        <%= user.type %>
      </span>
    </div>

    <div class="mt-2 grid grid-cols-1 gap-2 sm:grid-cols-2">
      <div class="sm:col-span-1">
        <%= f.label :name, class: "text-sm font-medium text-body" %>
        <%= f.text_field :name,
            placeholder: "Full name",
            class: "input-field min-h-[30px] w-full" %>
      </div>

      <div class="sm:col-span-1">
        <%= f.label :email_address, "Email", class: "text-sm font-medium text-body" %>
        <%= f.email_field :email_address,
            autocomplete: "email",
            class: "input-field min-h-[30px] w-full" %>
      </div>

      <div class="sm:col-span-1">
        <%= f.label :phone, class: "text-sm font-medium text-body" %>
        <%= f.telephone_field :phone,
            autocomplete: "tel",
            class: "input-field min-h-[30px] w-full" %>
      </div>

      <div class="sm:col-span-2">
        <%= f.label :notes, class: "text-sm font-medium text-body" %>
        <%= f.text_area :notes, rows: 3,
            placeholder: "Optional notesâ€¦",
            class: "input-field w-full" %>
      </div>
    </div>
  </div>

  <div class="px-3 py-2.5">
    <h2 class="text-xs font-semibold uppercase tracking-wider text-muted">Display settings</h2>
    <p class="text-xs text-muted">Theme, font size, and sidebar preference.</p>

    <div class="mt-2 grid grid-cols-1 gap-2 sm:grid-cols-2">
      <div>
        <%= f.label :theme, class: "text-sm font-medium text-body" %>
        <%= f.select :theme, [["Light", "light"], ["Dark", "dark"], ["Dim", "dim"]], {},
            class: "input-field min-h-[30px] w-full" %>
      </div>

      <div>
        <%= f.label :font_size, "Font size", class: "text-sm font-medium text-body" %>
        <%= f.select :font_size, [["Default", "default"], ["Large", "large"], ["Extra large", "xlarge"]], {},
            class: "input-field min-h-[30px] w-full" %>
      </div>

      <div class="sm:col-span-2">
        <div class="flex min-h-[30px] items-center justify-between rounded-md border border-theme bg-[var(--color-border)]/20 px-3 py-1.5">
          <div>
            <p class="text-sm font-medium text-body">Collapse sidebar on desktop</p>
            <p class="text-xs text-muted">Hide the sidebar by default on large screens.</p>
          </div>
          <div class="pt-0.5">
            <%= f.check_box :sidebar_collapsed,
                class: "h-4 w-4 border-[var(--color-border)] text-accent focus:ring-[var(--color-accent)]" %>
          </div>
        </div>
      </div>

      <div class="sm:col-span-2">
        <p class="text-sm font-medium text-body">Dashboard metrics</p>
        <p class="text-xs text-muted">Choose which metrics to show on the dashboard. Leave all checked for default.</p>
        <div class="mt-1.5 flex flex-wrap gap-x-3 gap-y-1">
          <% DashboardMetrics.available_keys.each do |key| %>
            <label class="flex min-h-[30px] cursor-pointer items-center gap-1.5 rounded-md border border-theme bg-[var(--color-border)]/20 px-2.5 py-1 hover:bg-[var(--color-border)]/30">
              <%= f.check_box :dashboard_metric_keys,
                  { multiple: true, include_hidden: false, checked: user.dashboard_metric_keys_for_form.include?(key), class: "h-3.5 w-3.5 border-[var(--color-border)] text-accent focus:ring-[var(--color-accent)]" },
                  key,
                  nil %>
              <span class="text-sm text-body"><%= DashboardMetrics.label_for(key) %></span>
            </label>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="px-3 py-2.5" data-controller="push-permission" data-push-permission-vapid-public-key-value="<%= ENV['VAPID_PUBLIC_KEY'] %>">
    <h2 class="text-xs font-semibold uppercase tracking-wider text-muted">Push Notifications</h2>
    <p class="text-xs text-muted">Receive browser notifications when reports finish or backups complete.</p>

    <div class="mt-2">
      <div class="flex min-h-[30px] items-center justify-between rounded-md border border-theme bg-[var(--color-border)]/20 px-3 py-1.5">
        <div>
          <p class="text-sm font-medium text-body">Enable push notifications</p>
          <p class="text-xs text-muted" data-push-permission-target="status">Checking status...</p>
        </div>
        <div class="pt-0.5">
          <input type="checkbox"
                 data-push-permission-target="toggle"
                 data-action="change->push-permission#togglePush"
                 class="h-4 w-4 border-[var(--color-border)] text-accent focus:ring-[var(--color-accent)]">
        </div>
      </div>
    </div>
  </div>

  <div class="px-3 py-2.5">
    <h2 class="text-xs font-semibold uppercase tracking-wider text-muted">Password</h2>
    <p class="text-xs text-muted">Leave blank to keep your current password.</p>

    <div class="mt-2 grid grid-cols-1 gap-2 sm:grid-cols-2">
      <div class="sm:col-span-1">
        <%= f.label :password, class: "text-sm font-medium text-body" %>
        <%= f.password_field :password,
            autocomplete: "new-password",
            class: "input-field min-h-[30px] w-full" %>
      </div>

      <div class="sm:col-span-1">
        <%= f.label :password_confirmation, class: "text-sm font-medium text-body" %>
        <%= f.password_field :password_confirmation,
            autocomplete: "new-password",
            class: "input-field min-h-[30px] w-full" %>
      </div>
    </div>
  </div>

  <div class="px-3 py-2">
    <div class="flex items-center justify-end">
      <%= f.submit "Save changes",
          class: "inline-flex min-h-[30px] items-center justify-center rounded-md bg-accent px-2.5 py-1 text-sm font-medium text-[color:var(--color-page)] hover:bg-[var(--color-accent-hover)]" %>
    </div>
  </div>
<% end %>
