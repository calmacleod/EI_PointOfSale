<% content_for :title, "Store Tasks" %>

<% content_for :breadcrumbs do %>
  <li><%= link_to "Dashboard", root_path, class: "font-medium text-body hover:text-accent" %></li>
  <li><span aria-hidden="true">›</span></li>
  <li aria-current="page" class="text-muted">Store Tasks</li>
<% end %>

<div class="lg:flex lg:min-h-0 lg:flex-1 lg:flex-col">
  <%= render "shared/page_header", title: "Store Tasks", description: "Track things that need to get done around the store." do %>
    <%= link_to "New task", new_store_task_path,
        class: "inline-flex min-h-[30px] items-center justify-center rounded-md bg-accent px-2.5 py-1 text-sm font-semibold text-[color:var(--color-page)] hover:bg-[var(--color-accent-hover)]",
        data: { turbo_prefetch: true } %>
  <% end %>

  <div class="mt-2 flex flex-col gap-2 lg:min-h-0 lg:flex-1">
    <%= render "shared/filter_bar", config: @filter_config, saved_queries: @saved_queries %>

    <%= render "shared/data_table", config: @filter_config, records: @store_tasks, pagy: @pagy,
               empty_message: "No tasks yet. Create one to get started." do |t| %>
      <% t.cell(:title) { |task|
           capture do
             concat(link_to(task.title, store_task_path(task), class: "font-medium text-accent hover:underline", data: { turbo_frame: "_top", turbo_prefetch: true }))
             if task.overdue?
               concat(" ")
               concat(status_chip("Overdue", :error))
             end
           end
         } %>
      <% t.cell(:status) { |task|
           variant = case task.status
                     when "not_started" then :neutral
                     when "in_progress" then :info
                     when "blocked" then :warning
                     when "done" then :success
                     end
           status_chip(task.status_label, variant)
         } %>
      <% t.cell(:assigned_to_id) { |task| task.assigned_to&.name || "—" } %>
      <% t.cell(:due_date) { |task| task.due_date ? l(task.due_date, format: :short) : "—" } %>
      <% t.cell(:created_at) { |task| local_time(task.created_at, format: :short) } %>
      <% t.cell(:actions) { |task|
           link_to("Edit", edit_store_task_path(task), class: "text-xs font-medium text-accent hover:opacity-80", data: { turbo_frame: "_top", turbo_prefetch: true })
         } %>
    <% end %>
  </div>
</div>
