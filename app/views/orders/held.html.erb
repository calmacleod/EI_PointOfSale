<% content_for :title, "Held Orders" %>

<div data-controller="modal" class="lg:flex lg:min-h-0 lg:flex-1 lg:flex-col">
  <%= render "shared/page_header", title: "Held Orders" do %>
    <%= link_to register_path, class: "inline-flex min-h-[30px] items-center justify-center rounded-md border border-theme bg-surface px-2.5 py-1 text-sm font-semibold text-body hover:bg-[var(--color-border)]/30" do %>
      Back to Register
    <% end %>
  <% end %>

  <div class="mt-2 flex flex-col gap-2 lg:min-h-0 lg:flex-1">
    <%= render "shared/filter_bar", config: @filter_config, saved_queries: @saved_queries %>

    <%= render "shared/data_table", config: @filter_config, records: @held_orders, pagy: @pagy,
               empty_message: "No held orders found." do |t| %>
      <% t.cell(:number) { |order| modal_trigger(order) } %>
      <% t.cell(:customer) { |order| customer_cell(order) } %>
      <% t.cell(:items_count) { |order| order.order_lines.sum(:quantity) } %>
      <% t.cell(:held_at) { |order| time_ago_in_words(order.held_at) + " ago" } %>
      <% t.cell(:created_by) { |order| order.created_by&.name || order.created_by&.email_address } %>
      <% t.cell(:total) { |order| number_to_currency(order.total) } %>
      <% t.cell(:actions) { |order| action_buttons(order) } %>
    <% end %>
  </div>

  <%# Order detail modals for each held order %>
  <% @held_orders.each do |order| %>
    <%= render "held_order_modal", order: order %>
  <% end %>
</div>
