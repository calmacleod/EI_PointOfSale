<% if local_assigns[:audits] && audits.present? %>
  <div class="mt-2 overflow-hidden rounded-lg border border-theme bg-surface">
    <div class="border-b border-theme bg-surface-alt px-3 py-1.5">
      <h2 class="text-sm font-semibold text-body">Audit Trail</h2>
      <% if local_assigns[:audits_count] %>
        <p class="text-xs text-muted"><%= pluralize(audits_count, "change") %> recorded</p>
      <% end %>
    </div>

    <ul class="divide-y divide-[var(--color-border)]">
      <% audits.each do |audit| %>
        <li class="px-3 py-1.5">
          <div class="flex flex-wrap items-baseline gap-x-2 gap-y-0.5">
            <span class="text-xs font-medium text-body"><%= audit.user&.email_address || "System" %></span>
            <span class="text-xs text-muted"><%= audit.action.titleize %></span>
            <span class="text-xs text-muted"><%= time_ago_in_words(audit.created_at) %> ago</span>
          </div>
          <% if audit.audited_changes.present? %>
            <ul class="mt-0.5 space-y-0.5 text-xs text-muted">
              <% audit.audited_changes.each do |field, change| %>
                <li>
                  <span class="font-medium text-body"><%= field.titleize %>:</span>
                  <% if change.is_a?(Array) %>
                    <span><%= change[0].presence || "(empty)" %></span> â†’ <span class="text-body"><%= change[1].presence || "(empty)" %></span>
                  <% else %>
                    <span class="text-body"><%= change %></span>
                  <% end %>
                </li>
              <% end %>
            </ul>
          <% end %>
        </li>
      <% end %>
    </ul>

    <% if local_assigns[:audit_pagy] && audit_pagy.pages > 1 %>
      <div class="border-t border-theme px-3 py-1.5">
        <div class="pagy-nav">
          <%== pagy_nav(audit_pagy, id: "audit-pagination") %>
        </div>
      </div>
    <% end %>
  </div>
<% end %>
