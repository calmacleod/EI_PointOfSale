<% content_for :title, "Admin settings" %>

<% content_for :breadcrumbs do %>
  <li><%= link_to "Dashboard", root_path, class: "font-medium text-body hover:text-accent" %></li>
  <li><span aria-hidden="true">›</span></li>
  <li aria-current="page" class="text-muted">Admin settings</li>
<% end %>

<div class="mx-auto max-w-5xl">
  <%= render "shared/page_header", title: "Admin settings", description: "Configure the application and manage reference data." %>

  <div class="mt-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
    <%= link_to admin_tax_codes_path, class: "group block rounded-xl border border-theme bg-surface p-6 shadow-sm transition hover:border-[var(--color-accent)]/50 hover:shadow-md", data: { turbo_prefetch: true } do %>
      <div class="flex items-start justify-between gap-3">
        <div>
          <h2 class="text-lg font-semibold text-body group-hover:text-accent">Tax codes</h2>
          <p class="mt-1 text-sm text-muted">Manage tax rates for products and services.</p>
          <p class="mt-3 text-sm font-medium text-accent">Manage tax codes →</p>
        </div>
        <div class="rounded-lg bg-[var(--color-border)]/30 p-2.5 ring-1 ring-inset border-theme group-hover:bg-[var(--color-accent)]/10">
          <svg class="h-6 w-6 text-body" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path d="M10.75 10.818v2.614A3.13 3.13 0 0 0 11.888 13c.482-.314.664-.65.664-1.18 0-.657-.524-1.165-1.436-1.165-.899 0-1.432.508-1.432 1.165 0 .53.182.866.664 1.18.175.114.331.233.538.368v-2.614a.24.24 0 0 0-.118-.199 1.497 1.497 0 0 0-1.277.218 1.66 1.66 0 0 0-.577 1.195c0 .624.255 1.154.577 1.195.485.077 1.05.137 1.277.218.048.03.08.066.118.199z" />
            <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm1-13a1 1 0 1 0-2 0v.092a4.535 4.535 0 0 0-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 1 0-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 1 0 2 0v-.092a4.535 4.535 0 0 0 1.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0 0 11 9.092V7.151c.391.127.68.317.843.504a1 1 0 1 0 1.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd" />
          </svg>
        </div>
      </div>
    <% end %>

    <%= link_to admin_suppliers_path, class: "group block rounded-xl border border-theme bg-surface p-6 shadow-sm transition hover:border-[var(--color-accent)]/50 hover:shadow-md", data: { turbo_prefetch: true } do %>
      <div class="flex items-start justify-between gap-3">
        <div>
          <h2 class="text-lg font-semibold text-body group-hover:text-accent">Suppliers</h2>
          <p class="mt-1 text-sm text-muted">Manage product suppliers and contacts.</p>
          <p class="mt-3 text-sm font-medium text-accent">Manage suppliers →</p>
        </div>
        <div class="rounded-lg bg-[var(--color-border)]/30 p-2.5 ring-1 ring-inset border-theme group-hover:bg-[var(--color-accent)]/10">
          <svg class="h-6 w-6 text-body" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" />
          </svg>
        </div>
      </div>
    <% end %>

    <%= link_to admin_audits_path, class: "group block rounded-xl border border-theme bg-surface p-6 shadow-sm transition hover:border-[var(--color-accent)]/50 hover:shadow-md", data: { turbo_prefetch: true } do %>
      <div class="flex items-start justify-between gap-3">
        <div>
          <h2 class="text-lg font-semibold text-body group-hover:text-accent">Audit trail</h2>
          <p class="mt-1 text-sm text-muted">View all create, update, and delete events.</p>
          <p class="mt-3 text-sm font-medium text-accent">View audit trail →</p>
        </div>
        <div class="rounded-lg bg-[var(--color-border)]/30 p-2.5 ring-1 ring-inset border-theme group-hover:bg-[var(--color-accent)]/10">
          <svg class="h-6 w-6 text-body" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.256A11.949 11.949 0 018 15.5c0 3.058 1.836 5.741 4.256 7.086A2 2 0 0018 15V3a1 1 0 100-2H3zm11 4a1 1 0 01 1-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1V7zm-3 4a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2zm-3 4a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H7a1 1 0 01-1-1v-2z" clip-rule="evenodd" />
          </svg>
        </div>
      </div>
    <% end %>
  </div>

  <%= form_with model: @store, url: admin_settings_path, method: :patch, class: "mt-8 rounded-xl border border-theme bg-surface p-6 shadow-sm", data: { controller: "address-autofill", address_autofill_token_value: mapbox_access_token } do |f| %>
    <% if @store.errors.any? %>
      <div class="mb-6 rounded-lg border border-[var(--color-error-border)] bg-[var(--color-error-bg)] px-4 py-3">
        <p class="text-base font-semibold text-[var(--color-error-text)]">Please fix the following:</p>
        <ul class="mt-2 list-disc space-y-1 pl-5 text-base text-[var(--color-error-text)]">
          <% @store.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <h2 class="text-lg font-semibold text-body">Store information</h2>
    <p class="mt-1 text-sm text-muted">Contact details shown on receipts and in the app.</p>

    <div class="mt-5 grid grid-cols-1 gap-4 sm:grid-cols-2">
      <div class="sm:col-span-2">
        <%= f.label :name, "Store name", class: "block text-base font-medium text-body" %>
        <%= f.text_field :name,
            placeholder: "e.g. Acme Comics & Games",
            class: "input-field mt-1 block w-full min-h-[44px]" %>
        <p class="mt-1 text-sm text-muted">Shown on receipts and in the app header.</p>
      </div>

      <div>
        <%= f.label :phone, "Phone", class: "block text-base font-medium text-body" %>
        <%= f.telephone_field :phone,
            placeholder: "e.g. 1-416-555-0100",
            class: "input-field mt-1 block w-full min-h-[44px]" %>
      </div>

      <div>
        <%= f.label :email, "Email", class: "block text-base font-medium text-body" %>
        <%= f.email_field :email,
            placeholder: "e.g. store@example.com",
            class: "input-field mt-1 block w-full min-h-[44px]" %>
      </div>

      <div class="sm:col-span-2">
        <label for="address_search" class="block text-base font-medium text-body">Address</label>
        <input type="text"
            id="address_search"
            autocomplete="address-line1"
            placeholder="Start typing to search for your address..."
            class="input-field mt-1 block w-full min-h-[44px]"
            data-address-autofill-target="searchInput">
        <p class="mt-1 text-sm text-muted">Select a suggestion to fill the fields below, or type manually.</p>
      </div>

      <div class="sm:col-span-2">
        <%= f.label :address_line1, "Address line 1", class: "block text-base font-medium text-body" %>
        <%= f.text_field :address_line1,
            autocomplete: "off",
            placeholder: "Street address",
            class: "input-field mt-1 block w-full min-h-[44px]",
            data: { address_autofill_target: "addressLine1" } %>
      </div>

      <div class="sm:col-span-2">
        <%= f.label :address_line2, "Address line 2", class: "block text-base font-medium text-body" %>
        <%= f.text_field :address_line2,
            autocomplete: "off",
            placeholder: "Suite, unit, building (optional)",
            class: "input-field mt-1 block w-full min-h-[44px]",
            data: { address_autofill_target: "addressLine2" } %>
      </div>

      <div>
        <%= f.label :city, "City", class: "block text-base font-medium text-body" %>
        <%= f.text_field :city,
            autocomplete: "off",
            placeholder: "City",
            class: "input-field mt-1 block w-full min-h-[44px]",
            data: { address_autofill_target: "city" } %>
      </div>

      <div>
        <%= f.label :province, "Province", class: "block text-base font-medium text-body" %>
        <%= f.text_field :province,
            autocomplete: "off",
            placeholder: "Province",
            class: "input-field mt-1 block w-full min-h-[44px]",
            data: { address_autofill_target: "province" } %>
      </div>

      <div>
        <%= f.label :postal_code, "Postal code", class: "block text-base font-medium text-body" %>
        <%= f.text_field :postal_code,
            autocomplete: "off",
            placeholder: "A1A 1A1",
            class: "input-field mt-1 block w-full min-h-[44px]",
            data: { address_autofill_target: "postalCode" } %>
      </div>

      <div>
        <%= f.label :country, "Country", class: "block text-base font-medium text-body" %>
        <%= f.text_field :country,
            autocomplete: "off",
            placeholder: "Canada",
            class: "input-field mt-1 block w-full min-h-[44px]",
            data: { address_autofill_target: "country" } %>
      </div>

    </div>

    <div class="mt-6 flex items-center justify-end">
      <%= f.submit "Save settings",
          class: "inline-flex min-h-[44px] items-center justify-center rounded-lg bg-accent px-4 py-3 text-base font-semibold text-[color:var(--color-page)] shadow-sm hover:opacity-90" %>
    </div>
  <% end %>
</div>
