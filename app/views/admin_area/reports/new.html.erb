<% content_for :title, "New report — #{@template.title}" %>

<% content_for :breadcrumbs do %>
  <li><%= link_to "Dashboard", root_path, class: "font-medium text-body hover:text-accent" %></li>
  <li><span aria-hidden="true">›</span></li>
  <li><%= link_to "Admin settings", admin_settings_path, class: "font-medium text-body hover:text-accent" %></li>
  <li><span aria-hidden="true">›</span></li>
  <li><%= link_to "Reports", admin_reports_path, class: "font-medium text-body hover:text-accent" %></li>
  <li><span aria-hidden="true">›</span></li>
  <li aria-current="page" class="text-muted">New report</li>
<% end %>

<div class="mx-auto max-w-3xl">
  <%= render "shared/page_header", title: @template.title, description: @template.description %>

  <%= form_with url: admin_reports_path, method: :post, class: "mt-3 rounded-lg border border-theme bg-surface p-2.5" do |f| %>
    <%= f.hidden_field :report_type, name: "report[report_type]", value: @template.key %>

    <h2 class="text-sm font-semibold text-body">Parameters</h2>
    <p class="mt-0.5 text-xs text-muted">Configure the report parameters below, then click generate.</p>

    <div class="mt-2 grid grid-cols-1 gap-2 sm:grid-cols-2">
      <% @template.parameters.each do |param| %>
        <div>
          <%= label_tag "report_parameters_#{param[:key]}", param[:label],
              class: "text-sm font-medium text-body" %>

          <% case param[:type] %>
          <% when :date %>
            <%= date_field_tag "report[parameters][#{param[:key]}]", nil,
                id: "report_parameters_#{param[:key]}",
                required: param[:required],
                class: "input-field mt-0.5 w-full min-h-[30px]" %>
          <% when :string %>
            <%= text_field_tag "report[parameters][#{param[:key]}]", nil,
                id: "report_parameters_#{param[:key]}",
                required: param[:required],
                class: "input-field mt-0.5 w-full min-h-[30px]" %>
          <% when :integer %>
            <%= number_field_tag "report[parameters][#{param[:key]}]", nil,
                id: "report_parameters_#{param[:key]}",
                required: param[:required],
                class: "input-field mt-0.5 w-full min-h-[30px]" %>
          <% end %>
        </div>
      <% end %>
    </div>

    <div class="mt-3 flex items-center justify-end gap-2">
      <%= link_to "Cancel", admin_reports_path,
          class: "inline-flex min-h-[30px] items-center justify-center border border-theme bg-surface px-2.5 py-1 text-sm font-medium text-body hover:bg-[var(--color-border)]/30" %>
      <%= f.submit "Generate report",
          class: "inline-flex min-h-[30px] items-center justify-center bg-accent px-2.5 py-1 text-sm font-medium text-[color:var(--color-page)] hover:opacity-90" %>
    </div>
  <% end %>
</div>
